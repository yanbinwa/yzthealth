adminDomain = 'c.freewifibox.com';
function getel(a){return document.getElementById?document.getElementById(a):document.all?document.all[a]:void 0}function log(a){if(fwbController.debug&&("function"==typeof trace?trace(a):"object"==typeof console&&console.debug(a),getel("debugarea"))){var c=getel("debugarea");c.value=c.value+"\n"+a,c.scrollTop=c.scrollHeight-c.clientHeight}}function dumpObject(a){var c,d,b="";for(c in a)if(b=b+"    "+c+" = "+a[c]+"\n","object"==typeof a[c])for(d in a[c])b=b+"      "+d+" = "+a[c][d]+"\n";return b}function FwbMD5(){function d(a,b){var c,d,e,i,l,m,n,o,p;for(a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b,c=1732584193,d=-271733879,e=-1732584194,i=271733878,l=0;l<a.length;l+=16)m=c,n=d,o=e,p=i,c=f(c,d,e,i,a[l+0],7,-680876936),i=f(i,c,d,e,a[l+1],12,-389564586),e=f(e,i,c,d,a[l+2],17,606105819),d=f(d,e,i,c,a[l+3],22,-1044525330),c=f(c,d,e,i,a[l+4],7,-176418897),i=f(i,c,d,e,a[l+5],12,1200080426),e=f(e,i,c,d,a[l+6],17,-1473231341),d=f(d,e,i,c,a[l+7],22,-45705983),c=f(c,d,e,i,a[l+8],7,1770035416),i=f(i,c,d,e,a[l+9],12,-1958414417),e=f(e,i,c,d,a[l+10],17,-42063),d=f(d,e,i,c,a[l+11],22,-1990404162),c=f(c,d,e,i,a[l+12],7,1804603682),i=f(i,c,d,e,a[l+13],12,-40341101),e=f(e,i,c,d,a[l+14],17,-1502002290),d=f(d,e,i,c,a[l+15],22,1236535329),c=g(c,d,e,i,a[l+1],5,-165796510),i=g(i,c,d,e,a[l+6],9,-1069501632),e=g(e,i,c,d,a[l+11],14,643717713),d=g(d,e,i,c,a[l+0],20,-373897302),c=g(c,d,e,i,a[l+5],5,-701558691),i=g(i,c,d,e,a[l+10],9,38016083),e=g(e,i,c,d,a[l+15],14,-660478335),d=g(d,e,i,c,a[l+4],20,-405537848),c=g(c,d,e,i,a[l+9],5,568446438),i=g(i,c,d,e,a[l+14],9,-1019803690),e=g(e,i,c,d,a[l+3],14,-187363961),d=g(d,e,i,c,a[l+8],20,1163531501),c=g(c,d,e,i,a[l+13],5,-1444681467),i=g(i,c,d,e,a[l+2],9,-51403784),e=g(e,i,c,d,a[l+7],14,1735328473),d=g(d,e,i,c,a[l+12],20,-1926607734),c=h(c,d,e,i,a[l+5],4,-378558),i=h(i,c,d,e,a[l+8],11,-2022574463),e=h(e,i,c,d,a[l+11],16,1839030562),d=h(d,e,i,c,a[l+14],23,-35309556),c=h(c,d,e,i,a[l+1],4,-1530992060),i=h(i,c,d,e,a[l+4],11,1272893353),e=h(e,i,c,d,a[l+7],16,-155497632),d=h(d,e,i,c,a[l+10],23,-1094730640),c=h(c,d,e,i,a[l+13],4,681279174),i=h(i,c,d,e,a[l+0],11,-358537222),e=h(e,i,c,d,a[l+3],16,-722521979),d=h(d,e,i,c,a[l+6],23,76029189),c=h(c,d,e,i,a[l+9],4,-640364487),i=h(i,c,d,e,a[l+12],11,-421815835),e=h(e,i,c,d,a[l+15],16,530742520),d=h(d,e,i,c,a[l+2],23,-995338651),c=j(c,d,e,i,a[l+0],6,-198630844),i=j(i,c,d,e,a[l+7],10,1126891415),e=j(e,i,c,d,a[l+14],15,-1416354905),d=j(d,e,i,c,a[l+5],21,-57434055),c=j(c,d,e,i,a[l+12],6,1700485571),i=j(i,c,d,e,a[l+3],10,-1894986606),e=j(e,i,c,d,a[l+10],15,-1051523),d=j(d,e,i,c,a[l+1],21,-2054922799),c=j(c,d,e,i,a[l+8],6,1873313359),i=j(i,c,d,e,a[l+15],10,-30611744),e=j(e,i,c,d,a[l+6],15,-1560198380),d=j(d,e,i,c,a[l+13],21,1309151649),c=j(c,d,e,i,a[l+4],6,-145523070),i=j(i,c,d,e,a[l+11],10,-1120210379),e=j(e,i,c,d,a[l+2],15,718787259),d=j(d,e,i,c,a[l+9],21,-343485551),c=k(c,m),d=k(d,n),e=k(e,o),i=k(i,p);return[c,d,e,i]}function e(a,b,c,d,e,f){return k(l(k(k(b,a),k(d,f)),e),c)}function f(a,b,c,d,f,g,h){return e(b&c|~b&d,a,b,f,g,h)}function g(a,b,c,d,f,g,h){return e(b&d|c&~d,a,b,f,g,h)}function h(a,b,c,d,f,g,h){return e(b^c^d,a,b,f,g,h)}function j(a,b,c,d,f,g,h){return e(c^(b|~d),a,b,f,g,h)}function k(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function l(a,b){return a<<b|a>>>32-b}function m(a){var e,b=[],d=(1<<c)-1;for(e=0;e<a.length*c;e+=c)b[e>>5]|=(a.charCodeAt(e/c)&d)<<e%32;return b}function n(b){var e,c=a?"0123456789ABCDEF":"0123456789abcdef",d="";for(e=0;e<4*b.length;e++)d+=c.charAt(15&b[e>>2]>>8*(e%4)+4)+c.charAt(15&b[e>>2]>>8*(e%4));return d}function o(b){var e,f,c=a?"0123456789ABCDEF":"0123456789abcdef",d="";for(f=0;f<b.length;f++)e=b.charCodeAt(f),d+=c.charAt(e/16),d+=c.charAt(e%16);return d}function p(a){a=a.toLowerCase(),a=a.replace(/ /g,"");var b=[];for(i=0;i<4*a.length;i+=8)octet=parseInt(a.substr(i/4,2),16),b[i>>5]|=(255&octet)<<i%32;return b}var a=0,c=8;this.hex_md5=function(a){return n(d(m(a),a.length*c))},this.chap=function(a,b,c){var e=o(b),f=a+e+c,g=p(f),h=d(g,4*f.length);return n(h)}}function updateUI(){timeLeftCounter=fwbController.session.sessionTimeout-fwbController.accounting.sessionTime,timeOnlineCounter=fwbController.accounting.sessionTime,showTicks(),"undefined"!=typeof modalObj&&("1"==fwbController.clientState?(loginFromWrapObj.style.display="none",stateInfoWrapObj.style.display="inline-block"):(loginFromWrapObj.style.display="inline-block",stateInfoWrapObj.style.display="none"),usernameShowObj.innerHTML=fwbController.session.userName,stateShowObj.innerHTML="1"==fwbController.clientState?"在线":"离线",byteCounterShowObj.innerHTML=((fwbController.accounting.inputOctets+fwbController.accounting.outputOctets)/1048576).toFixed(3)+"MB"),"undefined"!=typeof fwbController.message&&""!=fwbController.message&&(alert(fwbController.message),delete fwbController.message),"undefined"!=typeof fwbController.redir.redirectionURL&&""!=fwbController.redir.redirectionURL&&(location.href=fwbController.redir.redirectionURL),1>timeLeftCounter&&(alert("账户上网余量不足!"),fwbController.logoff())}function handleErrors(){}function showTicks(){var a=1;"undefined"!=typeof modalObj&&(timeOnlineShowObj.innerHTML=fwbController.formatTime(timeOnlineCounter),timeLeftShowObj.innerHTML=fwbController.formatTime(timeLeftCounter)),"undefined"!=typeof intervalId&&clearInterval(intervalId),intervalId=setInterval(function(){a>fwbController.interval&&clearInterval(intervalId),timeLeftCounter--,timeOnlineCounter++,"undefined"!=typeof modalObj&&(timeOnlineShowObj.innerHTML=fwbController.formatTime(timeOnlineCounter),timeLeftShowObj.innerHTML=fwbController.formatTime(timeLeftCounter)),a++},1e3)}function anonymousLogin(){"1"!=fwbController.clientState&&(fwbController.logon("anonymous","anonymous"),"undefined"!=typeof fwbController.message&&""!=fwbController.message&&(alert(fwbController.message),delete fwbController.message),"undefined"!=typeof fwbController.redir.redirectionURL&&""!=fwbController.redir.redirectionURL&&(location.href=fwbController.redir.redirectionURL))}function userLogin(){Modal.open({content:'<div id="loginFromWrap" ><h3>账户登陆</h3>用户账户：<input id="loginUsername" name="username" type="text" placeholder="用户名/手机号码"><br>登陆密码：<input id="loginPsw" name="password" type="password" placeholder="******"><br><input type="submit" id="login_submit" value="登陆"><input type="submit" id="login_getpsw" value="获取手机号服务密码"><hr style="float:left;"><p style="float:left;text-align:center;display:block;width:100%;padding-top:2px;border-top:1px solid #A8B5B5;margin-top:3px;"><small>关注微信 <code id="wx_name">FreeWiFiBox</code> ，获取上网账户</small></p></div><div id="stateInfoWrap" style="display:none;"><h3>账户状态</h3><p><b>账户名称：</b><span id="usernameShow"></span></p><p><b>登陆状态：</b><span id="stateShow"></span>&nbsp;&nbsp;<a href="http://'+fwbController.host+":"+fwbController.port+'/logoff">退出</a></p>'+'<p><b>在线时长：</b><span id="timeOnlineShow"></span></p>'+'<p><b>剩余时长：</b><span id="timeLeftShow"></span></p>'+'<p><b>流量统计：</b><span id="byteCounterShow"></span></p>'+"</div>",width:"280px",draggable:!0,openCallback:function(){if(usernameObj=getel("loginUsername"),pswObj=getel("loginPsw"),getpswObj=getel("login_getpsw"),submitObj=getel("login_submit"),loginFromWrapObj=getel("loginFromWrap"),stateInfoWrapObj=getel("stateInfoWrap"),usernameShowObj=getel("usernameShow"),stateShowObj=getel("stateShow"),timeOnlineShowObj=getel("timeOnlineShow"),timeLeftShowObj=getel("timeLeftShow"),byteCounterShowObj=getel("byteCounterShow"),modalObj=!0,"1"!=fwbController.clientState){loginFromWrapObj.style.display="inline-block",stateInfoWrapObj.style.display="none",usernameObj.focus();var a=getQueryString("nasid");ajaxLoad("GET","http://"+adminDomain+"/api/weixinname?nasid="+a+"&t="+Math.random(),function(){4==xmlhttp.readyState&&200==xmlhttp.status&&(WxNameObj=getel("wx_name"),WxNameObj.innerHTML=xmlhttp.responseText)}),getpswObj.addEventListener("click",function(){var a=getQueryString("nasid"),b=getQueryString("mac"),c=getQueryString("called"),d=usernameObj.value;/^1\d{10}$/g.test(d)?ajaxLoad("GET","http://"+adminDomain+"/api/mobilephone?nasid="+a+"&mobilephone="+d+"&mac="+b+"&ap="+c+"&t="+Math.random(),function(){4==xmlhttp.readyState&&200==xmlhttp.status&&("SUCCESS"==xmlhttp.responseText?alert("短信密码已发送，请注意查收."):"OVERLOAD"==xmlhttp.responseText?alert("短信密码已发送，请稍后重新获取."):alert(xmlhttp.responseText))}):(alert("手机号码格式错误."),usernameObj.value="")},!1),submitObj.addEventListener("click",function(){fwbController.logon(usernameObj.value,pswObj.value)},!1)}else loginFromWrapObj.style.display="none",stateInfoWrapObj.style.display="inline-block",usernameShowObj.innerHTML=fwbController.session.userName,stateShowObj.innerHTML="1"==fwbController.clientState?"在线":"离线","undefined"==typeof timeOnlineCounter?(timeOnlineShowObj.innerHTML=fwbController.formatTime(fwbController.accounting.sessionTime),timeLeftShowObj.innerHTML=fwbController.formatTime(fwbController.session.sessionTimeout-fwbController.accounting.sessionTime)):(timeOnlineShowObj.innerHTML=fwbController.formatTime(timeOnlineCounter),timeLeftShowObj.innerHTML=fwbController.formatTime(timeLeftCounter)),byteCounterShowObj.innerHTML=((fwbController.accounting.inputOctets+fwbController.accounting.outputOctets)/1048576).toFixed(3)+"MB","undefined"!=typeof fwbController.message&&""!=fwbController.message&&(alert(fwbController.message),delete fwbController.message),"undefined"!=typeof fwbController.redir.redirectionURL&&""!=fwbController.redir.redirectionURL&&(location.href=fwbController.redir.redirectionURL)}})}function getQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null}function ajaxLoad(a,b,c){xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=c,xmlhttp.open(a,b,!0),xmlhttp.send()}var fwbController,fwbJSON,fwbClock,Modal,fwbLibrary={revision:"85",apiVersion:"2.0"};fwbController&&fwbController.host||(fwbController={interval:30,host:"1.0.0.1",port:!1,ident:"00",ssl:!1,uamService:!1}),fwbController.stateCodes={UNKNOWN:-1,NOT_AUTH:0,AUTH:1,AUTH_PENDING:2,AUTH_SPLASH:3},fwbController.session={},fwbController.accounting={},fwbController.redir={},fwbController.location={name:""},fwbController.challenge="",fwbController.message="",fwbController.clientState=fwbController.stateCodes.UNKNOWN,fwbController.command="",fwbController.autorefreshTimer=0,fwbController.urlRoot=function(){var a=fwbController.ssl?"https":"http",b=a+"://"+fwbController.host+(fwbController.port?":"+fwbController.port.toString():"")+"/json/";return b},fwbController.onUpdate=function(a){log(">> Default onUpdate handler. <<\n>> You should write your own. <<\n>> cmd = "+a+" <<")},fwbController.onError=function(a){log(">> Default Error Handler<<\n>> You should write your own  <<\n>> "+a+" <<")},fwbController.formatTime=function(a,b){var c,d,e,f,g,h;return"undefined"==typeof a?"Not available":(a=parseInt(a,10),"undefined"!=typeof b&&0===a?b:(c=Math.floor(a/3600),d=Math.floor((a-3600*c)/60),e=a%60,f=e.toString(),10>e&&(f="0"+f),g=d.toString(),10>d&&(g="0"+g),h=c.toString(),10>c&&(h="0"+h),60>a?f+"秒":3600>a?g+"分"+f+"秒":h+"小时"+g+"分"+f+"秒"))},fwbController.formatBytes=function(a,b){var c,d,e;return a="undefined"==typeof a?0:parseInt(a,10),"undefined"!=typeof b&&0===a?b:(c=Math.round(a/10)/100,1>c?a+" Bytes":(d=Math.round(c/10)/100,1>d?c+" Kilobytes":(e=Math.round(d/10)/100,1>e?d+" Megabytes":e+" Gigabytes")))},fwbController.logon=function(a,b){"string"!=typeof a&&fwbController.onError(1,"username missing (or incorrect type)"),"string"!=typeof b&&fwbController.onError(2,"password missing (or incorrect type)"),log('fwbController.logon( "'+a+'" , "'+b+' " )'),fwbController.temp={username:a,password:b},fwbController.command="logon",log("fwbController.logon: asking for a new challenge "),fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.logonStep2,fwbController.clientState=fwbController.AUTH_PENDING,fwbJSON.get(fwbController.urlRoot()+"status")},fwbController.logon2=function(a,b){"string"!=typeof a&&fwbController.onError(1,"username missing (or incorrect type)"),"string"!=typeof b&&fwbController.onError(2,"response missing (or incorrect type)"),log('fwbController.logon2( "'+a+'" , "'+b+' " )'),fwbController.temp={username:a,response:b},fwbController.command="logon2",log("fwbController.logon2: asking for a new challenge "),fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.logonStep2,fwbController.clientState=fwbController.AUTH_PENDING,fwbJSON.get(fwbController.urlRoot()+"status")},fwbController.logonStep2=function(a){var b,c,d,e,f,g,h,i;return log("Entering logonStep 2"),"string"!=typeof a.challenge?(log("logonStep2: cannot find a challenge. Aborting."),fwbController.onError("Cannot get challenge")):a.clientSate===fwbController.stateCodes.AUTH?(log("logonStep2: Already connected. Aborting."),fwbController.onError("Already connected.")):(b=a.challenge,c=fwbController.temp.username,d=fwbController.temp.password,e=fwbController.temp.response,log("fwbController.logonStep2: Got challenge = "+b),fwbController.uamService?(log("fwbController.logonStep2: Logon using uamService (external MD5 CHAP)"),f=-1===fwbController.uamService.indexOf("?")?"?":"&",g=fwbController.uamService+f+"username="+escape(c)+"&password="+escape(d)+"&challenge="+b,fwbController.queryObj&&fwbController.queryObj.userurl&&(g+="&userurl="+fwbController.queryObj.userurl),fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.logonStep3,fwbController.clientState=fwbController.AUTH_PENDING,fwbJSON.get(g)):(e&&""!=e||(h=new FwbMD5,e=h.chap(fwbController.ident,d,b),log("fwbController.logonStep2: Calculating CHAP-Password = "+e)),fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.processReply,fwbController.clientState=fwbController.stateCodes.AUTH_PENDING,i=fwbController.urlRoot()+"logon?username="+escape(c)+"&response="+e,fwbController.queryObj&&fwbController.queryObj.userurl&&(i+="&userurl="+fwbController.queryObj.userurl),fwbJSON.get(i)),void 0)},fwbController.logonStep3=function(a){var b,c;log("Entering logonStep 3"),b=fwbController.temp.username,"string"==typeof a.response&&(fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.processReply,fwbController.clientState=fwbController.stateCodes.AUTH_PENDING,c=fwbController.urlRoot()+"logon?username="+escape(b)+"&response="+a.response,fwbController.queryObj&&fwbController.queryObj.userurl&&(c+="&userurl="+fwbController.queryObj.userurl),fwbJSON.get(c))},fwbController.refresh=function(){fwbController.command=fwbController.autorefreshTimer?"autorefresh":"refresh",fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.processReply,fwbJSON.get(fwbController.urlRoot()+"status")},fwbController.logoff=function(){fwbController.command="logoff",fwbJSON.onError=fwbController.onError,fwbJSON.onJSONReady=fwbController.processReply,fwbJSON.get(fwbController.urlRoot()+"logoff")},fwbController.processReply=function(a){if("string"==typeof a.message){var b=document.createElement("div");b.innerHTML=a.message,fwbController.message=b.innerHTML}"string"==typeof a.challenge&&(fwbController.challenge=a.challenge),"object"==typeof a.location&&(fwbController.location=a.location),"object"==typeof a.accounting&&(fwbController.accounting=a.accounting),"object"==typeof a.redir&&(fwbController.redir=a.redir),"object"==typeof a.session&&(null==fwbController.session||fwbController.clientState!==fwbController.stateCodes.AUTH&&a.clientState===fwbController.stateCodes.AUTH)&&(fwbController.session=a.session,a.session.startTime&&(fwbController.session.startTime=new Date,fwbController.session.startTime.setTime(a.session.startTime))),a.clientState===fwbController.stateCodes.NOT_AUTH||a.clientState===fwbController.stateCodes.AUTH||a.clientState===fwbController.stateCodes.AUTH_SPLASH||a.clientState===fwbController.stateCodes.AUTH_PENDING?fwbController.clientState=a.clientState:fwbController.onError("Unknown clientState found in JSON reply"),fwbController.clientState===fwbController.stateCodes.AUTH?fwbController.autorefreshTimer||(fwbController.autorefreshTimer=setInterval("fwbController.refresh()",1e3*fwbController.interval)):fwbController.clientState===fwbController.stateCodes.NOT_AUTH&&(clearInterval(fwbController.autorefreshTimer),fwbController.autorefreshTimer=0),log("fwbController.processReply: Calling onUpdate. clienState = "+fwbController.clientState),fwbController.onUpdate(fwbController.command)},fwbJSON={timeout:25e3,timer:0,node:0,timestamp:0},fwbJSON.expired=function(){fwbJSON.node.text?log("fwbJSON: reply content \n"+fwbJSON.node.text):log("fwbJSON: request timed out (or reply is not valid JS)"),clearInterval(fwbJSON.timer),fwbJSON.timer=0,"number"!=typeof fwbJSON.node&&document.getElementsByTagName("head")[0].removeChild(fwbJSON.node),fwbJSON.node=0,fwbJSON.onError("JSON request timed out (or reply is not valid)")},fwbJSON.reply=function(a){var b,c;clearInterval(fwbJSON.timer),fwbJSON.timer=0,b=new Date,c=b.getTime(),fwbJSON.timestamp&&log("fwbJSON: JSON reply received in "+(c-fwbJSON.timestamp)+" ms\n"+dumpObject(a)),"number"!=typeof fwbJSON.node&&document.getElementsByTagName("head")[0].removeChild(fwbJSON.node),fwbJSON.node=0,fwbJSON.onJSONReady(a)},fwbJSON.get=function(a){var b,c,d;return"string"!=typeof a?(log("fwbJSON:error:Incorrect url passed to fwbJSON.get():"+a),fwbJSON.onError("Incorrect url passed to fwbJSON.get() "),void 0):(fwbJSON.url=a,fwbJSON.timer?(log("logon:   There is already a request running. Return without launching a new request."),void 0):(b=document.createElement("script"),b.type="text/javascript",c=-1===this.url.indexOf("?")?"?":"&",b.src=fwbJSON.url+c+"callback=fwbJSON.reply",b.src+="&"+Math.random(),fwbJSON.node=document.getElementsByTagName("head")[0].appendChild(b),fwbJSON.timer=setInterval("fwbJSON.expired()",fwbJSON.timeout),d=new Date,fwbJSON.timestamp=d.getTime(),log("fwbJSON: getting "+fwbJSON.url+" . Waiting for reply ..."),void 0))},fwbClock={isStarted:0},fwbClock.onTick=function(){log("You should define your own onTick() handler on this clock object. Clock value = "+this.value)},fwbClock.increment=function(){fwbClock.value=fwbClock.value+1,fwbClock.onTick(fwbClock.value)},fwbClock.resync=function(a){clearInterval(fwbClock.isStarted),fwbClock.value=parseInt(a,10),fwbClock.isStarted=setInterval("fwbClock.increment()",1e3)},fwbClock.start=function(a){"Number"!=typeof a?fwbClock.resync(0):fwbClock.resync(a)},fwbClock.stop=function(){clearInterval(fwbClock.isStarted),fwbClock.isStarted=0},document.write('<link href="http://'+adminDomain+'/theme/adsite/resourcex/jsmodal-light.min.css" rel="stylesheet" type="text/css" />'),fwbController.host="10.1.1.1",fwbController.port=3536,fwbController.interval=30,fwbController.onError=handleErrors,fwbController.onUpdate=updateUI,fwbController.refresh(),Modal=function(){"use strict";var h,i,a={},b={},c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),j={width:"auto",height:"auto",lock:!1,hideClose:!1,draggable:!1,closeAfter:0,openCallback:!1,closeCallback:!1,hideOverlay:!1};return a.open=function(k){b.width=k.width||j.width,b.height=k.height||j.height,b.lock=k.lock||j.lock,b.hideClose=k.hideClose||j.hideClose,b.draggable=k.draggable||j.draggable,b.closeAfter=k.closeAfter||j.closeAfter,b.closeCallback=k.closeCallback||j.closeCallback,b.openCallback=k.openCallback||j.openCallback,b.hideOverlay=k.hideOverlay||j.hideOverlay,h=function(){a.center({})},k.content&&!k.ajaxContent?f.innerHTML=k.content:k.ajaxContent&&!k.content?(d.className="modal-loading",a.ajax(k.ajaxContent,function(a){f.innerHTML=a})):f.innerHTML="",d.style.width=b.width,d.style.height=b.height,a.center({}),(b.lock||b.hideClose)&&(g.style.visibility="hidden"),b.hideOverlay||(c.style.visibility="visible"),d.style.visibility="visible",document.onkeypress=function(c){27===c.keyCode&&b.lock!==!0&&a.close()},g.onclick=function(){return b.hideClose?!1:(a.close(),void 0)},window.addEventListener?window.addEventListener("resize",h,!1):window.attachEvent&&window.attachEvent("onresize",h),b.draggable?(e.style.cursor="move",e.onmousedown=function(b){return a.drag(b),!1}):e.onmousedown=function(){return!1},b.closeAfter>0&&(i=window.setTimeout(function(){a.close()},1e3*b.closeAfter)),b.openCallback&&b.openCallback()},a.drag=function(a){var b=void 0!==window.event?window.event.clientX:a.clientX,c=void 0!==window.event?window.event.clientY:a.clientY,e=b-d.offsetLeft,f=c-d.offsetTop;document.onmousemove=function(a){b=void 0!==window.event?window.event.clientX:a.clientX,c=void 0!==window.event?window.event.clientY:a.clientY,d.style.left=b-e>0?b-e+"px":0,d.style.top=c-f>0?c-f+"px":0,document.onmouseup=function(){window.document.onmousemove=null}}},a.ajax=function(a,b){var c,e=!1,f=[function(){return new window.XMLHttpRequest},function(){return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")},function(){return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new window.ActiveXObject("Msxml2.XMLHTTP")}];for(c=0;c<f.length;c+=1){try{e=f[c]()}catch(g){}if(e!==!1)break}e.open("GET",a,!0),e.onreadystatechange=function(){4===e.readyState&&(200===e.status?(b(e.responseText),d.removeAttribute("class")):(b(e.responseText),d.removeAttribute("class")))},e.send(null)},a.close=function(){f.innerHTML="",c.setAttribute("style",""),c.style.cssText="",c.style.visibility="hidden",d.setAttribute("style",""),d.style.cssText="",d.style.visibility="hidden",e.style.cursor="default",g.setAttribute("style",""),g.style.cssText="",i&&window.clearTimeout(i),b.closeCallback&&b.closeCallback(),window.removeEventListener?window.removeEventListener("resize",h,!1):window.detachEvent&&window.detachEvent("onresize",h)},a.center=function(a){var b=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),e=Math.max(d.clientWidth,d.offsetWidth),f=Math.max(d.clientHeight,d.offsetHeight),g=0,h=0,i=0,j=0;"number"==typeof window.innerWidth?(g=window.innerWidth,h=window.innerHeight):document.documentElement&&document.documentElement.clientWidth&&(g=document.documentElement.clientWidth,h=document.documentElement.clientHeight),"number"==typeof window.pageYOffset?(j=window.pageYOffset,i=window.pageXOffset):document.body&&document.body.scrollLeft?(j=document.body.scrollTop,i=document.body.scrollLeft):document.documentElement&&document.documentElement.scrollLeft&&(j=document.documentElement.scrollTop,i=document.documentElement.scrollLeft),a.horizontalOnly||(d.style.top=j+h/2-f/2+"px"),d.style.left=i+g/2-e/2+"px",c.style.height=b+"px",c.style.width="100%"},c.setAttribute("id","modal-overlay"),d.setAttribute("id","modal-container"),e.setAttribute("id","modal-header"),f.setAttribute("id","modal-content"),g.setAttribute("id","modal-close"),e.appendChild(g),d.appendChild(e),d.appendChild(f),c.style.visibility="hidden",d.style.visibility="hidden",window.addEventListener?window.addEventListener("load",function(){document.body.appendChild(c),document.body.appendChild(d)},!1):window.attachEvent&&window.attachEvent("onload",function(){document.body.appendChild(c),document.body.appendChild(d)}),a}();
//20140326.12